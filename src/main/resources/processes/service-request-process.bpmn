<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.0.0">
  <process id="service-request-process" name="External Service Procurement" isExecutable="true" camunda:historyTimeToLive="P180D">
    <startEvent id="StartEvent_1" name="Request Received (1b)">
      <outgoing>Flow_1</outgoing>
    </startEvent>
    <sequenceFlow id="Flow_1" sourceRef="StartEvent_1" targetRef="Activity_CheckContract" />
    <serviceTask id="Activity_CheckContract" name="Validate Contract" camunda:delegateExpression="${checkContractDelegate}">
      <outgoing>Flow_Check_Result</outgoing>
    </serviceTask>
    <exclusiveGateway id="Gateway_Contract_Valid" name="Contract Valid?">
      <incoming>Flow_Check_Result</incoming>
      <outgoing>Flow_Contract_Invalid</outgoing>
      <outgoing>Flow_Contract_Valid</outgoing>
    </exclusiveGateway>
    <sequenceFlow id="Flow_Check_Result" sourceRef="Activity_CheckContract" targetRef="Gateway_Contract_Valid" />
    <sequenceFlow id="Flow_Contract_Invalid" name="No" sourceRef="Gateway_Contract_Valid" targetRef="Activity_Notify_Rejection">
      <conditionExpression xsi:type="tFormalExpression">${contractValid == false}</conditionExpression>
    </sequenceFlow>
    <serviceTask id="Activity_Notify_Rejection" name="Notify 1b (Contract Missing)" camunda:delegateExpression="${notifyContractRejectionDelegate}">
      <incoming>Flow_Contract_Invalid</incoming>
      <outgoing>Flow_End_Contract_Fail</outgoing>
    </serviceTask>
    <endEvent id="Flow_End_Contract_Fail" name="Process Terminated">
      <incoming>Flow_End_Contract_Fail</incoming>
    </endEvent>
    <sequenceFlow id="Flow_End_Contract_Fail" sourceRef="Activity_Notify_Rejection" targetRef="Flow_End_Contract_Fail" />
    <sequenceFlow id="Flow_Contract_Valid" name="Yes" sourceRef="Gateway_Contract_Valid" targetRef="Activity_PO_Approval">
      <conditionExpression xsi:type="tFormalExpression">${contractValid == true}</conditionExpression>
    </sequenceFlow>
    <userTask id="Activity_PO_Approval" name="Approve Request (PO)" camunda:assignee="po_user">
      <incoming>Flow_Contract_Valid</incoming>
      <incoming>Flow_RejectionFix</incoming>
      <outgoing>Flow_4</outgoing>
    </userTask>
    <exclusiveGateway id="Gateway_Approved" name="Approved?">
      <incoming>Flow_4</incoming>
      <outgoing>Flow_No_Approved</outgoing>
      <outgoing>Flow_Yes_Approved</outgoing>
    </exclusiveGateway>
    <sequenceFlow id="Flow_4" sourceRef="Activity_PO_Approval" targetRef="Gateway_Approved" />
    <sequenceFlow id="Flow_No_Approved" name="No" sourceRef="Gateway_Approved" targetRef="Activity_PM_Fix">
      <conditionExpression xsi:type="tFormalExpression">${approved == false}</conditionExpression>
    </sequenceFlow>
    <userTask id="Activity_PM_Fix" name="Fix Request (PM)" camunda:assignee="pm_user">
      <incoming>Flow_No_Approved</incoming>
      <outgoing>Flow_RejectionFix</outgoing>
    </userTask>
    <sequenceFlow id="Flow_RejectionFix" sourceRef="Activity_PM_Fix" targetRef="Activity_PO_Approval" />
    <sequenceFlow id="Flow_Yes_Approved" name="Yes" sourceRef="Gateway_Approved" targetRef="Activity_Publish">
      <conditionExpression xsi:type="tFormalExpression">${approved == true}</conditionExpression>
    </sequenceFlow>
    <serviceTask id="Activity_Publish" name="Publish to Providers" camunda:delegateExpression="${publishToProvidersDelegate}">
      <incoming>Flow_Yes_Approved</incoming>
      <outgoing>Flow_5</outgoing>
    </serviceTask>
    <sequenceFlow id="Flow_5" sourceRef="Activity_Publish" targetRef="Activity_PM_Evaluate" />
    <userTask id="Activity_PM_Evaluate" name="Evaluate Offers (PM)" camunda:assignee="pm_user">
      <incoming>Flow_5</incoming>
      <incoming>Flow_Selection_Reject</incoming>
      <outgoing>Flow_To_PO_Validate</outgoing>
    </userTask>
    <sequenceFlow id="Flow_To_PO_Validate" sourceRef="Activity_PM_Evaluate" targetRef="Activity_PO_Validate" />
    <userTask id="Activity_PO_Validate" name="Validate Selection (PO)" camunda:assignee="po_user">
      <incoming>Flow_To_PO_Validate</incoming>
      <outgoing>Flow_Gateway_Selection</outgoing>
    </userTask>
    <exclusiveGateway id="Gateway_Selection_Approved" name="Selection Valid?">
      <incoming>Flow_Gateway_Selection</incoming>
      <outgoing>Flow_Selection_Reject</outgoing>
      <outgoing>Flow_Selection_OK</outgoing>
    </exclusiveGateway>
    <sequenceFlow id="Flow_Gateway_Selection" sourceRef="Activity_PO_Validate" targetRef="Gateway_Selection_Approved" />
    <sequenceFlow id="Flow_Selection_Reject" name="No" sourceRef="Gateway_Selection_Approved" targetRef="Activity_PM_Evaluate">
      <conditionExpression xsi:type="tFormalExpression">${selectionApproved == false}</conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="Flow_Selection_OK" name="Yes" sourceRef="Gateway_Selection_Approved" targetRef="Activity_Notify_1b">
      <conditionExpression xsi:type="tFormalExpression">${selectionApproved == true}</conditionExpression>
    </sequenceFlow>
    <serviceTask id="Activity_Notify_1b" name="Send Recommendation to 1b" camunda:delegateExpression="${notify1bRecommendationDelegate}">
      <incoming>Flow_Selection_OK</incoming>
      <outgoing>Flow_Wait_1b</outgoing>
    </serviceTask>
    <sequenceFlow id="Flow_Wait_1b" sourceRef="Activity_Notify_1b" targetRef="Event_Wait_1b" />
    <receiveTask id="Event_Wait_1b" name="Wait for 1b Decision" messageRef="Message_1b_Decision" camunda:asyncBefore="true">
      <incoming>Flow_Wait_1b</incoming>
      <outgoing>Flow_After_Wait</outgoing>
    </receiveTask>
    <exclusiveGateway id="Gateway_1b_Decision" name="1b Decision?">
      <incoming>Flow_After_Wait</incoming>
      <outgoing>Flow_1b_No</outgoing>
      <outgoing>Flow_1b_Yes</outgoing>
    </exclusiveGateway>
    <sequenceFlow id="Flow_After_Wait" sourceRef="Event_Wait_1b" targetRef="Gateway_1b_Decision" />
    <sequenceFlow id="Flow_1b_No" name="No" sourceRef="Gateway_1b_Decision" targetRef="Activity_Notify_4b_Reject">
      <conditionExpression xsi:type="tFormalExpression">${oneBDecision == 'REJECTED'}</conditionExpression>
    </sequenceFlow>
    <serviceTask id="Activity_Notify_4b_Reject" name="Notify 4b (Rejected)" camunda:delegateExpression="${notifyProviderRejectDelegate}">
      <incoming>Flow_1b_No</incoming>
      <outgoing>Flow_End_Reject</outgoing>
    </serviceTask>
    <endEvent id="Flow_End_Reject" name="Request Rejected by 1b">
      <incoming>Flow_End_Reject</incoming>
    </endEvent>
    <sequenceFlow id="Flow_End_Reject" sourceRef="Activity_Notify_4b_Reject" targetRef="Flow_End_Reject" />
    <sequenceFlow id="Flow_1b_Yes" name="Yes" sourceRef="Gateway_1b_Decision" targetRef="Activity_RP_Coordination">
      <conditionExpression xsi:type="tFormalExpression">${oneBDecision == 'ACCEPTED'}</conditionExpression>
    </sequenceFlow>
    <userTask id="Activity_RP_Coordination" name="Confirm Logistics (RP)" camunda:assignee="rp_user">
      <incoming>Flow_1b_Yes</incoming>
      <outgoing>Flow_To_CreateOrder</outgoing>
    </userTask>
    <sequenceFlow id="Flow_To_CreateOrder" sourceRef="Activity_RP_Coordination" targetRef="Activity_CreateOrder" />
    <serviceTask id="Activity_CreateOrder" name="Create Service Order" camunda:delegateExpression="${createServiceOrderDelegate}">
      <incoming>Flow_To_CreateOrder</incoming>
      <outgoing>Flow_9</outgoing>
    </serviceTask>
    <sequenceFlow id="Flow_9" sourceRef="Activity_CreateOrder" targetRef="Activity_Notify_Win" />
    <serviceTask id="Activity_Notify_Win" name="Notify Provider (Win)" camunda:delegateExpression="${notifyProviderDelegate}">
      <incoming>Flow_9</incoming>
      <outgoing>Flow_To_Workforce</outgoing>
    </serviceTask>
    <sequenceFlow id="Flow_To_Workforce" sourceRef="Activity_Notify_Win" targetRef="Activity_NotifyWorkforce" />
    <serviceTask id="Activity_NotifyWorkforce" name="Update Workforce System" camunda:delegateExpression="${notifyWorkforceDelegate}">
      <incoming>Flow_To_Workforce</incoming>
      <outgoing>Flow_End</outgoing>
    </serviceTask>
    <endEvent id="EndEvent_Success" name="Service Order Active">
      <incoming>Flow_End</incoming>
    </endEvent>
    <sequenceFlow id="Flow_End" sourceRef="Activity_NotifyWorkforce" targetRef="EndEvent_Success" />
  </process>
  <message id="Message_1b_Decision" name="Message_1b_Decision" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="service-request-process">
      <bpmndi:BPMNEdge id="Flow_1_di" bpmnElement="Flow_1">
        <di:waypoint x="188" y="290" />
        <di:waypoint x="240" y="290" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Check_Result_di" bpmnElement="Flow_Check_Result">
        <di:waypoint x="340" y="290" />
        <di:waypoint x="395" y="290" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Contract_Invalid_di" bpmnElement="Flow_Contract_Invalid">
        <di:waypoint x="420" y="265" />
        <di:waypoint x="420" y="180" />
        <di:waypoint x="500" y="180" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="428" y="220" width="15" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_End_Contract_Fail_di" bpmnElement="Flow_End_Contract_Fail">
        <di:waypoint x="600" y="180" />
        <di:waypoint x="662" y="180" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Contract_Valid_di" bpmnElement="Flow_Contract_Valid">
        <di:waypoint x="445" y="290" />
        <di:waypoint x="500" y="290" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="464" y="272" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_4_di" bpmnElement="Flow_4">
        <di:waypoint x="600" y="290" />
        <di:waypoint x="655" y="290" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_No_Approved_di" bpmnElement="Flow_No_Approved">
        <di:waypoint x="680" y="265" />
        <di:waypoint x="680" y="180" />
        <di:waypoint x="760" y="180" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="688" y="220" width="15" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_RejectionFix_di" bpmnElement="Flow_RejectionFix">
        <di:waypoint x="810" y="140" />
        <di:waypoint x="810" y="100" />
        <di:waypoint x="550" y="100" />
        <di:waypoint x="550" y="250" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Yes_Approved_di" bpmnElement="Flow_Yes_Approved">
        <di:waypoint x="705" y="290" />
        <di:waypoint x="760" y="290" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="724" y="272" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_5_di" bpmnElement="Flow_5">
        <di:waypoint x="860" y="290" />
        <di:waypoint x="920" y="290" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_To_PO_Validate_di" bpmnElement="Flow_To_PO_Validate">
        <di:waypoint x="1020" y="290" />
        <di:waypoint x="1080" y="290" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Gateway_Selection_di" bpmnElement="Flow_Gateway_Selection">
        <di:waypoint x="1180" y="290" />
        <di:waypoint x="1245" y="290" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Selection_Reject_di" bpmnElement="Flow_Selection_Reject">
        <di:waypoint x="1270" y="265" />
        <di:waypoint x="1270" y="180" />
        <di:waypoint x="970" y="180" />
        <di:waypoint x="970" y="250" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1113" y="162" width="15" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Selection_OK_di" bpmnElement="Flow_Selection_OK">
        <di:waypoint x="1295" y="290" />
        <di:waypoint x="1350" y="290" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1314" y="272" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Wait_1b_di" bpmnElement="Flow_Wait_1b">
        <di:waypoint x="1450" y="290" />
        <di:waypoint x="1510" y="290" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_After_Wait_di" bpmnElement="Flow_After_Wait">
        <di:waypoint x="1610" y="290" />
        <di:waypoint x="1675" y="290" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1b_No_di" bpmnElement="Flow_1b_No">
        <di:waypoint x="1700" y="265" />
        <di:waypoint x="1700" y="180" />
        <di:waypoint x="1780" y="180" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1708" y="220" width="15" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_End_Reject_di" bpmnElement="Flow_End_Reject">
        <di:waypoint x="1880" y="180" />
        <di:waypoint x="1942" y="180" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1b_Yes_di" bpmnElement="Flow_1b_Yes">
        <di:waypoint x="1725" y="290" />
        <di:waypoint x="1780" y="290" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1744" y="272" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_To_CreateOrder_di" bpmnElement="Flow_To_CreateOrder">
        <di:waypoint x="1880" y="290" />
        <di:waypoint x="1940" y="290" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_9_di" bpmnElement="Flow_9">
        <di:waypoint x="2040" y="290" />
        <di:waypoint x="2100" y="290" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_To_Workforce_di" bpmnElement="Flow_To_Workforce">
        <di:waypoint x="2200" y="290" />
        <di:waypoint x="2260" y="290" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_End_di" bpmnElement="Flow_End">
        <di:waypoint x="2360" y="290" />
        <di:waypoint x="2422" y="290" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">
        <dc:Bounds x="152" y="272" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="126" y="315" width="89" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_CheckContract_di" bpmnElement="Activity_CheckContract">
        <dc:Bounds x="240" y="250" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_Contract_Valid_di" bpmnElement="Gateway_Contract_Valid" isMarkerVisible="true">
        <dc:Bounds x="395" y="265" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="382" y="322" width="77" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_Notify_Rejection_di" bpmnElement="Activity_Notify_Rejection">
        <dc:Bounds x="500" y="140" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Flow_End_Contract_Fail_di_shape" bpmnElement="Flow_End_Contract_Fail">
        <dc:Bounds x="662" y="162" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="653" y="205" width="55" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_PO_Approval_di" bpmnElement="Activity_PO_Approval">
        <dc:Bounds x="500" y="250" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_Approved_di" bpmnElement="Gateway_Approved" isMarkerVisible="true">
        <dc:Bounds x="655" y="265" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="653" y="322" width="54" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_PM_Fix_di" bpmnElement="Activity_PM_Fix">
        <dc:Bounds x="760" y="140" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_Publish_di" bpmnElement="Activity_Publish">
        <dc:Bounds x="760" y="250" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_PM_Evaluate_di" bpmnElement="Activity_PM_Evaluate">
        <dc:Bounds x="920" y="250" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_PO_Validate_di" bpmnElement="Activity_PO_Validate">
        <dc:Bounds x="1080" y="250" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_Selection_Approved_di" bpmnElement="Gateway_Selection_Approved" isMarkerVisible="true">
        <dc:Bounds x="1245" y="265" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1231" y="322" width="79" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_Notify_1b_di" bpmnElement="Activity_Notify_1b">
        <dc:Bounds x="1350" y="250" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_Wait_1b_di" bpmnElement="Event_Wait_1b">
        <dc:Bounds x="1510" y="250" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1b_Decision_di" bpmnElement="Gateway_1b_Decision" isMarkerVisible="true">
        <dc:Bounds x="1675" y="265" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1668" y="322" width="64" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_Notify_4b_Reject_di" bpmnElement="Activity_Notify_4b_Reject">
        <dc:Bounds x="1780" y="140" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Flow_End_Reject_di_shape" bpmnElement="Flow_End_Reject">
        <dc:Bounds x="1942" y="162" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1917" y="205" width="87" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_RP_Coordination_di" bpmnElement="Activity_RP_Coordination">
        <dc:Bounds x="1780" y="250" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_CreateOrder_di" bpmnElement="Activity_CreateOrder">
        <dc:Bounds x="1940" y="250" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_Notify_Win_di" bpmnElement="Activity_Notify_Win">
        <dc:Bounds x="2100" y="250" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_NotifyWorkforce_di" bpmnElement="Activity_NotifyWorkforce">
        <dc:Bounds x="2260" y="250" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_Success_di" bpmnElement="EndEvent_Success">
        <dc:Bounds x="2422" y="272" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="2405" y="315" width="70" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>